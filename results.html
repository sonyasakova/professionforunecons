<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Results - Unecon Career Guidance</title>
    <meta name="description" content="Your personalized career assessment results and recommendations.">

    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="android-chrome-512x512.png">
    <link rel="manifest" href="site.webmanifest">

    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="results-page">
        <div class="results-hero">
            <div class="container">
                <h1>Your Career Assessment Results</h1>
                <p class="results-subtitle">Based on your psychological profile and decision-making patterns</p>
            </div>
        </div>

        <div class="container">
            <!-- Top Result Section -->
            <div class="top-result-section" id="topResultSection">
                <div class="top-result-header">
                    <span class="result-badge">üèÜ Your Top Match</span>
                    <div class="match-score" id="matchScore">--</div>
                </div>

                <h2 class="specialization-name" id="specializationName">Loading...</h2>
                <p class="specialization-description" id="specializationDescription"></p>

                <div class="info-grid">
                    <div class="career-prospects-card">
                        <div class="card-header">
                            <h3>Career Prospects</h3>
                            <span class="card-icon">üíº</span>
                        </div>
                        <ul class="career-list" id="careerList"></ul>
                    </div>

                    <div class="top5-preview-card">
                        <div class="card-header">
                            <h3>Your Top 5 Matches</h3>
                            <span class="card-icon">üìä</span>
                        </div>
                        <div class="top5-mini-list" id="top5MiniList"></div>
                    </div>
                </div>

                <div class="professionals-section">
                    <h3>Notable Professionals in This Field</h3>
                    <div class="professionals-grid" id="professionalsGrid"></div>
                </div>
            </div>

            <!-- All Results Section -->
            <div class="all-results-section" id="allResultsSection">
                <div class="section-header">
                    <div>
                        <h2>Complete Career Match Analysis</h2>
                        <p class="section-subtitle">All 29 specializations ranked by compatibility</p>
                    </div>
                    <div class="results-legend">
                        <span class="legend-item"><span class="legend-dot winner"></span>Top Match</span>
                        <span class="legend-item"><span class="legend-dot top5"></span>Top 5</span>
                        <span class="legend-item"><span class="legend-dot other"></span>Other</span>
                    </div>
                </div>
                <div id="allResultsContainer"></div>
            </div>

            <!-- Actions Section -->
            <div class="actions-section">
                <button class="btn btn-primary btn-large" onclick="retakeAssessment()">
                    Retake Test
                </button>
            </div>
        </div>
    </div>

    <footer class="page-footer">
        UNECON
    </footer>

    <!-- Load data files -->
    <script src="data.js"></script>
    <script src="professionals.js"></script>

    <!-- Results calculation and display logic -->
    <script>
        // Calculate results
        function calculateResults() {
            const savedAnswers = localStorage.getItem('quizAnswers');

            if (!savedAnswers) {
                // No answers found, redirect to start
                window.location.href = 'index.html';
                return null;
            }

            const answers = JSON.parse(savedAnswers);

            // Initialize scores for all specializations
            const scores = new Array(specializations.length).fill(0);

            // Calculate total possible score per specialization
            let maxPossibleScore = 0;

            // Process each answer
            questions.forEach((question) => {
                const answerIndex = answers[question.id];

                if (answerIndex !== undefined) {
                    const selectedAnswer = question.answers[answerIndex];
                    const probabilities = selectedAnswer.probabilities;

                    // Add probabilities to scores
                    probabilities.forEach((prob, index) => {
                        scores[index] += prob;
                    });

                    // Track max possible score (highest probability value for this question)
                    maxPossibleScore += Math.max(...probabilities);
                }
            });

            // Convert to percentages
            const percentages = scores.map(score => {
                return (score / maxPossibleScore) * 100;
            });

            // Create results array with specialization names
            const results = specializations.map((spec, index) => ({
                name: spec,
                percentage: percentages[index],
                score: scores[index]
            }));

            // Sort by percentage (highest first)
            results.sort((a, b) => b.percentage - a.percentage);

            // Check if winner has sufficient lead (10-15% above second place)
            const winner = results[0];
            const secondPlace = results[1];
            const lead = winner.percentage - secondPlace.percentage;

            // If lead is insufficient, recalculate to ensure clear winner
            if (lead < 10) {
                // Boost the top scorer slightly to ensure clear distinction
                winner.percentage = Math.min(100, winner.percentage + (10 - lead));
            }

            return results;
        }

        // Display top result
        function displayTopResult(result, allResults) {
            document.getElementById('specializationName').textContent = result.name;

            // Display match score with animation
            const matchScoreEl = document.getElementById('matchScore');
            matchScoreEl.textContent = result.percentage.toFixed(1) + '%';
            matchScoreEl.style.setProperty('--percentage', result.percentage);

            const data = specializationData[result.name];

            if (data) {
                document.getElementById('specializationDescription').textContent = data.description;

                // Display careers
                const careerList = document.getElementById('careerList');
                careerList.innerHTML = '';
                data.careers.forEach((career, index) => {
                    const li = document.createElement('li');
                    li.textContent = career;
                    li.style.animationDelay = `${index * 0.1}s`;
                    careerList.appendChild(li);
                });

                // Display Top 5 mini preview
                const top5MiniList = document.getElementById('top5MiniList');
                top5MiniList.innerHTML = '';
                allResults.slice(0, 5).forEach((item, index) => {
                    const miniItem = document.createElement('div');
                    miniItem.className = 'top5-mini-item';
                    miniItem.style.animationDelay = `${index * 0.1}s`;
                    miniItem.innerHTML = `
                        <div class="mini-rank">${index + 1}</div>
                        <div class="mini-info">
                            <div class="mini-name">${item.name}</div>
                            <div class="mini-bar-container">
                                <div class="mini-bar" style="width: ${item.percentage}%"></div>
                            </div>
                        </div>
                        <div class="mini-percentage">${item.percentage.toFixed(1)}%</div>
                    `;
                    top5MiniList.appendChild(miniItem);
                });

                // Display professionals
                const professionalsGrid = document.getElementById('professionalsGrid');
                professionalsGrid.innerHTML = '';

                const professionals = professionalsData[result.name];

                if (professionals) {
                    professionals.forEach((professional, index) => {
                        const card = createProfessionalCard(professional);
                        card.style.animationDelay = `${index * 0.15}s`;
                        professionalsGrid.appendChild(card);
                    });
                }
            }
        }

        // Create professional card
        function createProfessionalCard(professional) {
            const card = document.createElement('div');
            card.className = 'professional-card';

            // Get initials for placeholder
            const initials = professional.name
                .split(' ')
                .map(word => word[0])
                .join('')
                .toUpperCase()
                .substring(0, 2);

            card.innerHTML = `
                <div class="professional-image-container">
                    <img src="${professional.image}"
                         alt="${professional.name}"
                         class="professional-image"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                    <div class="professional-placeholder" style="display: none;">${initials}</div>
                </div>
                <h4 class="professional-name">${professional.name}</h4>
                <p class="professional-workplace">${professional.workplace}</p>
                <p class="professional-achievement">${professional.achievement}</p>
            `;

            return card;
        }

        // Display all results
        function displayAllResults(results) {
            const container = document.getElementById('allResultsContainer');
            container.innerHTML = '';

            results.forEach((result, index) => {
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                resultItem.style.animationDelay = `${index * 0.03}s`;

                let barClass = 'other';
                let percentageClass = 'other';
                let rankBadge = '';

                if (index === 0) {
                    barClass = 'winner';
                    percentageClass = 'winner';
                    rankBadge = '<span class="rank-badge gold">1</span>';
                } else if (index < 5) {
                    barClass = 'top-5';
                    percentageClass = 'top-5';
                    rankBadge = `<span class="rank-badge top5">${index + 1}</span>`;
                } else {
                    rankBadge = `<span class="rank-badge">${index + 1}</span>`;
                }

                resultItem.innerHTML = `
                    <div class="result-item-header">
                        ${rankBadge}
                        <span class="result-item-name">${result.name}</span>
                        <span class="result-item-percentage ${percentageClass}">
                            ${result.percentage.toFixed(1)}%
                        </span>
                    </div>
                    <div class="result-bar-container">
                        <div class="result-bar ${barClass}" style="width: 0%;" data-width="${result.percentage}"></div>
                    </div>
                `;

                container.appendChild(resultItem);

                // Animate bar after a short delay
                setTimeout(() => {
                    const bar = resultItem.querySelector('.result-bar');
                    bar.style.width = bar.dataset.width + '%';
                }, 100 + (index * 30));
            });
        }

        // Retake assessment
        function retakeAssessment() {
            if (confirm('Are you sure you want to retake the assessment? This will clear your current results.')) {
                localStorage.removeItem('quizAnswers');
                localStorage.removeItem('currentQuestion');
                window.location.href = 'index.html';
            }
        }

        // Initialize results page
        function initResults() {
            const results = calculateResults();

            if (results) {
                displayTopResult(results[0], results);
                displayAllResults(results);

                // Trigger staggered animations
                setTimeout(() => {
                    document.getElementById('topResultSection').classList.add('visible');
                }, 100);

                setTimeout(() => {
                    document.getElementById('allResultsSection').classList.add('visible');
                }, 600);
            }
        }

        // Load results when page loads
        window.addEventListener('DOMContentLoaded', initResults);
    </script>
</body>
</html>
